<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Reading and processing flight data • throne</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reading and processing flight data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">throne</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/overview.html">Overview</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-field-workflow" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Field workflow</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-field-workflow">
<li><a class="dropdown-item" href="../articles/collect_n_process_thermal_images.html">Collect and process thermal images</a></li>
    <li><a class="dropdown-item" href="../articles/collect_otm_data.html">Collect OTM data</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-r-workflow" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">R Workflow</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-r-workflow">
<li><a class="dropdown-item" href="../articles/rnp_flights_data.html">Reading and processing flight data</a></li>
    <li><a class="dropdown-item" href="../articles/rnp_otms_data_gen_otm_splines.html">Reading and processing OTM data + Generating OTM splines</a></li>
    <li><a class="dropdown-item" href="../articles/correct_flights_data.html">Correct flight data</a></li>
    <li><a class="dropdown-item" href="../articles/predict_thermal_landscapes.html">Match data and predict thermal landscapes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/example.html">Case study</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ggcostoya/throne"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Reading and processing flight data</h1>
            
      

      <div class="d-none name"><code>rnp_flights_data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The goal of this vignette is to illustrate the process behind the
<code>rnp_flights_data</code> (<strong>r</strong>ead
a<strong>n</strong>d <strong>p</strong>rocess flights data) function of
the <code>throne</code> package. This function enables processing of raw
<code>.tif</code> files obtained by combining images collected during a
drone flight (see the <a href="https://ggcostoya.github.io/throne/articles/drone_setup.html">Flying
drones and obtaining thermal orthomosaics vignette</a>) into a data
frame structure easily manageable in <code>R</code>. This data frame
will later be related to operative temperature model
(<strong>OTM</strong>) data to finally predict thermal landscapes.
Below, we highlight the section of the package’s workflow that is
covered in this vignette:</p>
<p><img src="images%2Frnp_flights_data_workflow.jpg" width="100%" style="display: block; margin: auto;"></p>
<p>Next, we present how the <code>rnp_flights_data</code> function works
by discussing it’s inputs, processes and output</p>
</div>
<div class="section level2">
<h2 id="inputs">Inputs<a class="anchor" aria-label="anchor" href="#inputs"></a>
</h2>
<p>The <code>rnp_flights_data</code> takes in 3 inputs:</p>
<ol style="list-style-type: decimal">
<li><p>The <strong><code>path</code></strong> to the directory where all
thermal orthomosaics (i.e., <code>.tif</code> files) for flights are
stored.</p></li>
<li><p>A <code>data.frame</code> with
<strong><code>metadata</code></strong> for each flight. This
<code>data.frame</code> must contain specific columns indicating the
<code>flight_id</code>, the <code>date</code> when the flight took place
and the times at which the flight started and ended. For more specific
information please check the function’s documentation <a href="https://ggcostoya.github.io/throne/reference/rnp_flights_data.html">here</a>.
Below is an example data set included with <code>throne</code>
illustrating how the <code>metadata</code> should be
structured:</p></li>
</ol>
<pre><code><span><span class="co">##    flight_id      date time_start time_end</span></span>
<span><span class="co">## 1    VAL2_01 8/24/2023       8:35     8:39</span></span>
<span><span class="co">## 6    VAL2_06 8/24/2023      10:38    10:42</span></span>
<span><span class="co">## 7    VAL2_07 8/24/2023      10:57    11:01</span></span>
<span><span class="co">## 8    VAL2_08 8/24/2023      11:20    11:24</span></span>
<span><span class="co">## 11   VAL2_11 8/24/2023      12:21    12:25</span></span>
<span><span class="co">## 12   VAL2_12 8/25/2023      10:27    10:31</span></span>
<span><span class="co">## 13   VAL2_13 8/25/2023      10:49    10:53</span></span>
<span><span class="co">## 25   VAL2_25 8/26/2023      15:26    15:30</span></span>
<span><span class="co">## 27   VAL2_27 8/26/2023      16:16    16:20</span></span>
<span><span class="co">## 30   VAL2_30 8/26/2023      17:31    17:35</span></span></code></pre>
<ol start="3" style="list-style-type: decimal">
<li>The spatial <code>resolution</code> to which the <code>.tif</code>
files should be summarized to in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>m</mi><mn>2</mn></msup><annotation encoding="application/x-tex">m^2</annotation></semantics></math>.
This parameter will control the This parameter will control the spatial
resolution of the final output and should be chosen according to the
spatial scale of the study organism.</li>
</ol>
</div>
<div class="section level2">
<h2 id="processes">Processes<a class="anchor" aria-label="anchor" href="#processes"></a>
</h2>
<p>To transform the original <code>.tif</code> files, the
<code>rnp_flights_data</code> goes through the following steps for all
<code>.tif</code> files specified:</p>
<ol style="list-style-type: decimal">
<li><p>Read each specified <code>.tif</code> file as a as a raster
object using the <code>rast</code> function from the <a href="https://rspatial.org/pkg/" class="external-link"><code>terra</code></a>
package.</p></li>
<li><p>Re-scale the resolution of the raster object to the desired
spatial <code>resolution</code> using <code>terra</code>’s
<code>aggregate</code> function.</p></li>
<li><p>Transform the raster object into a
<code>data.frame</code>.</p></li>
<li><p>Add metadata information, including the <code>year</code>, day of
the year (<code>doy</code>) and minute of the day when the flight
started (<code>mod_start</code>) and ended
(<code>mod_end</code>).</p></li>
</ol>
<blockquote>
<p><strong>NOTE</strong>: Working <code>doy</code> and <code>mod</code>
allows the user to work with numeric colums. This simplifies the
management of the data, as dates and times have unique data formats in
the <code>R</code> environment that are often difficult to handle and
may lead unintended errors. Nonetheless, these formats can be
transformed back into more interpretable temporal scales for
visualization purposes, <a href="https://stackoverflow.com/questions/24200014/convert-day-of-year-to-date" class="external-link">by
using the <code>as.Date</code> function to transform <code>doy</code>
(also known as Julian date) back into a YYYY-MM-DD format</a> and
dividing by 60 for <code>mod</code> to get hours.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h2>
<p>The final output of <code>rnp_flights_data</code> is a
<code>data.frame</code> with the following columns:</p>
<ul>
<li>
<code>x</code> and <code>y</code>: <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system" class="external-link">UTM
coordinates</a>.</li>
<li>
<code>year</code>, <code>doy</code>, <code>mod_start</code>,
<code>mod_end</code>: The year, day of the year, minute of the day when
the flight started and ended respectively.</li>
<li>
<code>surf_temp</code>: Surface IR-measured temperature (°C).</li>
</ul>
<p>Thus, each row on the <code>data.frame</code> will correspond to a
unique <code>surf_temp</code> measurement on a particular
<code>tile</code> (a unique <code>x</code> and <code>y</code>
combination) within a specific flight. The number of rows will in turn
depend on 1) the number of flights processed and 2) the desired spatial
<code>resolution</code>.</p>
<p>Below is an example data set showing how the output of
<code>rnp_flights_data</code> should look like:</p>
<pre><code><span><span class="co">##         x       y surf_temp year doy mod_start mod_end</span></span>
<span><span class="co">## 75 275330 4416550  25.82156 2023 236       515     519</span></span>
<span><span class="co">## 76 275331 4416550  25.08232 2023 236       515     519</span></span>
<span><span class="co">## 77 275332 4416550  23.77567 2023 236       515     519</span></span>
<span><span class="co">## 78 275333 4416550  24.48907 2023 236       515     519</span></span>
<span><span class="co">## 79 275334 4416550  19.89712 2023 236       515     519</span></span>
<span><span class="co">## 80 275335 4416550  10.46925 2023 236       515     519</span></span></code></pre>
<p>These data can already be processed to visualize and quantify the
thermal characteristics of a study site. Below we illustrate how to
visualize this data using <code>ggplot2</code> and 4 of the 10 fully
processed flights (with a spatial <code>resolution</code> of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mi>m</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">1m^2</annotation></semantics></math>)
we include in the <code>flights_data</code> example data set that is
included with <code>throne</code>. Panel titles indicate the hour in
which the flight took place.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flights_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">mod_start</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">515</span>, <span class="fl">680</span>, <span class="fl">926</span>, <span class="fl">1051</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">surf_temp</span> <span class="op">&gt;</span> <span class="fl">12</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>hour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">mod_start</span><span class="op">/</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>hour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">hour</span>,<span class="st">":00 h"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">surf_temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis</span><span class="op">(</span><span class="st">"Surface temperature (°C)"</span>, option <span class="op">=</span> <span class="st">"magma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">hour</span>, <span class="va">mod_start</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Longitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rnp_flights_data_files/figure-html/plot%20example%20flight%20data-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="choosing-the-appropriate-spatial-resolution">Choosing the appropriate spatial resolution<a class="anchor" aria-label="anchor" href="#choosing-the-appropriate-spatial-resolution"></a>
</h2>
<p>The <code>rnp_flights_data</code> function allows the user to specify
the spatial <code>resolution</code> to which the <code>.tif</code> files
should be summarized to. This parameter controls the spatial resolution
of the final output and should be chosen according to the spatial scale
of the study organism. We leave it up to the user to determine the
appropriate spatial resolution for their system but we consider it
important to highlight that a greater <code>resolution</code> will
result in a longer processing time in all subsequent steps. To choose
the appropriate resolution for their data, we recommend that users run
<code>rnp_flights_data</code> at multiple spatial resolutions and
visualize the output. Below is a plot illustrating one of the flights we
include in <code>throne</code> as an example processed at 0.5, 1 and 5
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>m</mi><mn>2</mn></msup><annotation encoding="application/x-tex">m^2</annotation></semantics></math>
of spatial resolution:</p>
<p><img src="images%2Frnp_flights_data_resolution_comparison.png" width="100%" style="display: block; margin: auto;"></p>
<p>Next, we will present how the <code>throne</code> package can read
and process OTM data and generate OTM and date specific spline
models.</p>
<nav aria-label="Page navigation"><ul class="pagination justify-content-end">
<li class="page-item">
<a class="page-link" href="collect_otm_data">Previous: Collect OTM
data</a>
</li>
<li class="page-item">
<a class="page-link" href="rnp_otms_data_gen_otm_splines.html">Next:
Read and process OTM data and Generate OTM splines</a>
</li>
</ul></nav>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Karla Alujević, Guillermo Garcia-Costoya, Noa Ratia, Emma Schmitz, Russell D. Godkin, Jelena Bujan, Akhila C. Gopal, Michael Logan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
