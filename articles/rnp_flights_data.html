<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="throne">
<title>Reading and processing flights data • throne</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reading and processing flights data">
<meta property="og:description" content="throne">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">throne</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/overview.html">Overview</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-field-setup">Field setup</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-field-setup">
    <a class="dropdown-item" href="../articles/flying_and_collecting_data_from_drones.html">Drones</a>
    <a class="dropdown-item" href="../articles/otms.html">OTMs</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-r-workflow">R Workflow</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-r-workflow">
    <a class="dropdown-item" href="../articles/rnp_flights_data.html">Reading and processing flight data</a>
    <a class="dropdown-item" href="../articles/rnp_otms_data_gen_otm_splines.html">Reading and processing OTM data</a>
    <a class="dropdown-item" href="../articles/correcting_flight_data.html">Correcting flight data</a>
    <a class="dropdown-item" href="../articles/predicting_thermal_landscapes.html">Predicting thermal landscapes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Reading and processing flights data</h1>
            
      
      
      <div class="d-none name"><code>rnp_flights_data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The goal of this vignette is to illustrate the process behind the
<code>rnp_flights_data</code> (<strong>r</strong>ead
a<strong>n</strong>d <strong>p</strong>rocess flights data) function of
the <code>throne</code> package. This function enables to processing of
raw <code>.tif</code> files obtained by combining images gathered during
a flight into a data structure easily manageable in <code>R</code> (a <a href="https://tibble.tidyverse.org/" class="external-link"><code>tibble</code></a>). This
<code>tibble</code> will later be related to operative temperature model
(<strong>OTM</strong>) data to finally predict thermal landscapes.
Below, we highlight the section of the package’s workflow that is
covered in this vignette:</p>
<p><img src="images/workflow_rnp_otms_data_gen_otm_splines.png" width="80%" style="display: block; margin: auto;"></p>
<p>Next, we present how the <code>rnp_flights_data</code> function
works, some notes on the choice of the parameter <code>digits</code> and
a worked-through example on how to use the function.</p>
</div>
<div class="section level2">
<h2 id="how-the-rnp_flights_data-function-works">How the <code>rnp_flights_data</code> function works<a class="anchor" aria-label="anchor" href="#how-the-rnp_flights_data-function-works"></a>
</h2>
<p>The <code>rnp_flight_data</code> function uses the functionality
developed by package <a href="https://rspatial.org/raster/pkg/index.html" class="external-link"><code>raster</code></a>
to transform a <code>.tif</code> file into a <code>tibble</code>
(similar to a <code>data.frame</code> in <code>R</code>). Below we
detail the functions inputs, processing and output.</p>
<p>The <code>rnp_flights_data</code> takes in 3 inputs:</p>
<ol style="list-style-type: decimal">
<li><p>The <strong><code>path</code></strong> to the directory where all
<code>.tif</code> files for flights are stored. The function will
process all <code>.tif</code> files stored in the folder. If there are
many and/or if each file is of considerable size, it will take a
substantial amount of time to run. Luckily, it will only need to be ran
once!</p></li>
<li><p>A <code>tibble</code> or <code>data.frame</code> with
<strong><code>metadata</code></strong> for each flight. This metadata
<code>tibble</code> must contain columns for <code>flight_id</code>, the
<code>date</code> when the flight took place (MM/DD/YYYY format), and
the time of the day when the flight started and ended
(<code>time_start</code> &amp; <code>time_end</code> columns in HH:MM
format). Below is an example metadata <code>tibble</code> we include as
part of the documentation of the <code>throne</code> package:</p></li>
</ol>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 34 × 4</span></span></span>
<span><span class="co">##    flight_id date      time_start time_end</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> flight01  8/24/2023 8:35       8:39    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> flight02  8/24/2023 8:59       9:03    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> flight03  8/24/2023 9:19       9:23    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> flight04  8/24/2023 9:42       9:46    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> flight05  8/24/2023 10:06      10:10   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> flight06  8/24/2023 10:38      10:42   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> flight07  8/24/2023 10:57      11:01   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> flight08  8/24/2023 11:20      11:24   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> flight09  8/24/2023 11:40      11:44   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> flight10  8/24/2023 12:00      12:04   </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 24 more rows</span></span></span></code></pre>
<ol start="3" style="list-style-type: decimal">
<li>The number of decimal <code>digits</code> to which the final output
should be summarized to. Specifying this parameter correctly is
essential as it will dictate the spatial resolution of each of the tiles
in the eventual thermal landscape. Since we believe this is an
absolutely critical issue, we include a section discussing this choice
in section @ref(digits) below.</li>
</ol>
<p>To transform the original <code>.tif</code> files, the
<code>rnp_flights_data</code> function goes through the following
general steps:</p>
<ol style="list-style-type: decimal">
<li><p>Read each specified <code>.tif</code> file as a as a raster
object using the <code>raster</code> function from the
<code>raster</code> package.</p></li>
<li><p>Re-project the coordinates of the raster <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system" class="external-link"><strong>Universal
Transverse Mercator</strong>(<strong>UTM</strong>)</a> coordinate system
to a more easy to interpret <a href="https://en.wikipedia.org/wiki/World_Geodetic_System" class="external-link"><strong>World
Geodetic System</strong>(<strong>WGS84</strong>)</a> coordinate system
(i.e., from a system based on UTM zones to the widely used decimal
latitude and longitude degrees), using the <code>projectRaster</code>
function also from the <code>raster</code> package.</p></li>
<li><p>Transform the raster into a <code>data.frame</code> via the
<code>rasterToPoints</code> function once again from the
<code>raster</code> package. The resulting <code>data.frame</code> will
have columns for longitude, latitude and IR temperature (i.e., the
temperature measured by the drone) and as many rows as combinations of
unique longitude and latitude values the initial <code>.tif</code> file
had. Each combination corresponds to a “tile” within your area of study
and the area of this “tile” will be determined by the number of decimal
digits of your latitude and longitude measurements as highlighted
earlier.</p></li>
<li><p>Round the number of decimal digits on all latitude and longitude
observations according to the <code>digits</code> argument.</p></li>
<li><p>Average the IR temperature across all observations with the same
averaged latitude and longitude.</p></li>
<li><p>Add the <code>metadata</code> corresponding to that flight to the
final output. Simultaneously, the <code>date</code>,
<code>time_start</code> and <code>time_end</code> columns of the
metadata file will be transformed into columns for <code>year</code>,
day of the year (<code>doy</code>), and minute of the day
(<code>mod</code>) when the flight started (<code>mod_start</code>) and
ended (<code>mod_end</code>).</p></li>
</ol>
<blockquote>
<p><strong>NOTE</strong>: We choose working with <code>doy</code> and
<code>mod</code> to simplify the management of the data as much as
possible. Date and time data have unique data formats in the
<code>R</code> environment that are often difficult to handle for users
and that might lead to unintended errors. By using <code>doy</code> and
<code>mod</code>, the user deals with integer columns, much easier to
operate with and manipulate. Further, these formats can be easily
transformed back into more easily interpretable scales for visualization
purposes, <a href="https://stackoverflow.com/questions/24200014/convert-day-of-year-to-date" class="external-link">by
using the <code>as.Date</code> function to transform <code>doy</code>
(also known as Julian date) back into a YYYY-MM-DD format</a> and
dividing by 60 for <code>mod</code> to get hours.</p>
</blockquote>
<p>The final output is a <code>tibble</code> object with columns for
longitude, latitude and IR-measured temperature (<code>ir_temp</code>).
The number of rows of this data set will vary depending on the number of
flights that are processed simultaneously, based on the area covered by
eacg flight and the number of <code>digits</code> specified. For
instance, our study area was ~ 2900 <span class="math inline">\(m^2\)</span>, which processed setting
<code>digits = 5</code> led to a <code>tibble</code> of ~7500
observations per flight each representing a “tile” of approximately 0.4
<span class="math inline">\(m^2\)</span> at a latitude of approximately
40° (See more details on the choice of the <code>digits</code> argument
in section @ref(digits)).</p>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 263,008 × 7</span></span></span>
<span><span class="co">##    longitude latitude ir_temp  year   doy mod_start mod_end</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>     -<span style="color: #BB0000;">120.</span>     39.9    12.5  <span style="text-decoration: underline;">2</span>023   236       515     519</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>     -<span style="color: #BB0000;">120.</span>     39.9    14.4  <span style="text-decoration: underline;">2</span>023   236       515     519</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>     -<span style="color: #BB0000;">120.</span>     39.9    14.0  <span style="text-decoration: underline;">2</span>023   236       515     519</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>     -<span style="color: #BB0000;">120.</span>     39.9    13.7  <span style="text-decoration: underline;">2</span>023   236       515     519</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>     -<span style="color: #BB0000;">120.</span>     39.9    14.6  <span style="text-decoration: underline;">2</span>023   236       515     519</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>     -<span style="color: #BB0000;">120.</span>     39.9    15.3  <span style="text-decoration: underline;">2</span>023   236       515     519</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>     -<span style="color: #BB0000;">120.</span>     39.9    14.5  <span style="text-decoration: underline;">2</span>023   236       515     519</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>     -<span style="color: #BB0000;">120.</span>     39.9    14.5  <span style="text-decoration: underline;">2</span>023   236       515     519</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>     -<span style="color: #BB0000;">120.</span>     39.9    13.9  <span style="text-decoration: underline;">2</span>023   236       515     519</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>     -<span style="color: #BB0000;">120.</span>     39.9    13.9  <span style="text-decoration: underline;">2</span>023   236       515     519</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 262,998 more rows</span></span></span></code></pre>
<p>Once the raw <code>.tif</code> file is processed, the resulting
<code>tibble</code> can already be used to quantify the thermal
characteristics of a study site from a spatially discrete perspective.
To illustrate this, below we plot 4 of the 34 fully processed flights
(with <code>digits = 5</code>) over the same area we offer in the
<code>throne</code> package as example data. Panel titles indicate the
hour in which the flight took place</p>
<p><img src="rnp_flights_data_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="digits">Choosing the appropriate <code>digits</code>.<a class="anchor" aria-label="anchor" href="#digits"></a>
</h2>
<p>The argument <code>digits</code> determines the number of decimal
digit places to which latitude and longitude information should be
rounded to. This argument will therefore determine the spatial
resolution of your final measurement as different latitude and longitude
decimal digits correspond to different distances. As a generalization, 1
degree of latitude can be approximated to 111.32 km, a relationship that
can be extended to decimal digits as seen below.</p>
<p><img src="rnp_flights_data_files/figure-html/unnamed-chunk-5-1.png" width="768" style="display: block; margin: auto;"></p>
<p>In contrast, due to the curvature of the Earth the distance
represented by a longitude degree is also dependent on latitude. You can
find more information on how to transform degrees longitude into
distances <a href="https://en.wikipedia.org/wiki/Decimal_degrees" class="external-link">here</a>.
Furthermore, the <a href="https://ejanalysis.github.io/proxistat/" class="external-link"><code>proxistat</code></a>
<code>R</code>package provides helpful functions to transform coordinate
systems into measurable distances. Below we use <code>proxistat</code>
functions to illustrate how latitude influences the distance represented
by a longitudinal degree.</p>
<pre><code><span><span class="co">## Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2</span></span>
<span><span class="co">## 3.5.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use the `legend.position.inside` argument of `theme()` instead.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<p><img src="rnp_flights_data_files/figure-html/unnamed-chunk-6-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Based on the above, in the majority of cases, <strong>we recommend
setting the argument <code>digits = 5</code></strong>. This will provide
a spatial resolution of ~ 1.2 <span class="math inline">\(m^2\)</span>
at the equator which will gradually descend to as little as ~ 0.5 <span class="math inline">\(m^2\)</span> at 66° Latitude as seen below.</p>
<p><img src="rnp_flights_data_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></p>
<p>This spatial resolution guarantees that the original
<code>.tif</code> file is processed at a scale that is relevant for the
majority of study organisms for which this package is intended. However,
we leave this decision up to the user to consider the spatial scale that
is most relevant for their organism. In the image below (figure S1 in
the accompanying paper), we illustrate the same flight processed when
the argument <code>digits</code> is set to 4, 5 and 6 respectively.</p>
</div>
<div class="section level2">
<h2 id="a-worked-out-example">A worked out example<a class="anchor" aria-label="anchor" href="#a-worked-out-example"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
