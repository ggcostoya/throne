<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="throne">
<title>A worked out example: Thermoregulation in high elevation lizards • throne</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A worked out example: Thermoregulation in high elevation lizards">
<meta property="og:description" content="throne">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">throne</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/overview.html">Overview</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-field-workflow">Field workflow</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-field-workflow">
    <a class="dropdown-item" href="../articles/collect_n_process_thermal_images.html">Collect and process thermal images</a>
    <a class="dropdown-item" href="../articles/collect_otm_data.html">Collect OTM data</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-r-workflow">R Workflow</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-r-workflow">
    <a class="dropdown-item" href="../articles/rnp_flights_data.html">Reading and processing flight data</a>
    <a class="dropdown-item" href="../articles/rnp_otms_data_gen_otm_splines.html">Reading and processing OTM data + Generating OTM splines</a>
    <a class="dropdown-item" href="../articles/correct_flights_data.html">Correct flight data</a>
    <a class="dropdown-item" href="../articles/predict_thermal_landscapes.html">Match data and predict thermal landscapes</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/example.html">Case study</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ggcostoya/throne">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>A worked out example: Thermoregulation in high elevation lizards</h1>
            
      
      
      <div class="d-none name"><code>example.Rmd</code></div>
    </div>

    
    
<style>
p.caption {
  font-size: 0.9em;
}
</style>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In this vignette we illustrate a case study to serve as a worked out
example on how to implement the <code>throne</code> method. In this
example, we will be looking at the thermal environment experienced by a
population of western fence lizards (<em>Sceloporus occidentalis</em>)
living at approximately 2400 m of elevation in the Great Basin of
Northern Nevada and undergoing mark-recapture. Following the
<code>throne</code> method, we will first describe our field methodology
(i.e., flights conducted, operative temperature model deployment etc.),
then describe the analysis ran in <code>R</code> using the
<code>throne</code> package and finally offer some insights on how the
<code>throne</code> method could be used in ecological studies.</p>
</div>
<div class="section level2">
<h2 id="study-area-and-organism">Study area and organism<a class="anchor" aria-label="anchor" href="#study-area-and-organism"></a>
</h2>
<p>The population of western fence lizards discussed in this example
inhabits a high elevation outcrop in the Great Basin of Northern Nevada.
The site is characterized by a mosaic of sagebrush and pinyon-juniper
woodlands interrupted by rocky outcrops of varying sizes. The area of
interest also has a remarked degree of topographic heterogeneity with a
ridge along the north-south axis dividing into two slopes:</p>
<div class="figure" style="text-align: center">
<img src="images/c_study_area.png" alt="Study area within the Great Basin of Northern Nevada, the red rectangle indicates the specific area of interest we will be focusing on." width="60%"><p class="caption">
Study area within the Great Basin of Northern Nevada, the red rectangle
indicates the specific area of interest we will be focusing on.
</p>
</div>
<div class="figure" style="text-align: center">
<img src="images/c_study_area_terrain.png" alt="Topography of the area of study. A ridge divides the area between an eastern-facing side a relatively gentle slope and a western-facing side with a steep slope even becoming a precipice in some spots" width="60%"><p class="caption">
Topography of the area of study. A ridge divides the area between an
eastern-facing side a relatively gentle slope and a western-facing side
with a steep slope even becoming a precipice in some spots
</p>
</div>
<p>The study organism for this example is the western fence lizard
(<em>Sceloporus occidentalis</em>), a species native the western US that
is locally abundant in the study area. This lizard is predominately
spotted in the rocky outcrops that interrupt the landscape which it uses
to bask during day-time hours. This example focuses on 10 adult lizards
that underwent mark-recapture during the month August of 2022.</p>
<div class="figure" style="text-align: center">
<img src="images/c_study_organism.png" alt="A western fence lizard basking on a rock in the study area. Note that this individual is marked through a color combination painted on its side (Blue - Silver - Pink) used to identify it in the field." width="60%"><p class="caption">
A western fence lizard basking on a rock in the study area. Note that
this individual is marked through a color combination painted on its
side (Blue - Silver - Pink) used to identify it in the field.
</p>
</div>
</div>
<div class="section level2">
<h2 id="field-workflow">Field workflow<a class="anchor" aria-label="anchor" href="#field-workflow"></a>
</h2>
<div class="section level3">
<h3 id="collect-and-process-thermal-images-">Collect and process thermal images.<a class="anchor" aria-label="anchor" href="#collect-and-process-thermal-images-"></a>
</h3>
<p>We flew 3 flights over an ~ 95000 <span class="math inline">\(m^2\)</span> area overlapping with the areas that
we surveyed as part of the lizard mark-recapture. Two flights were
conducted on the same day (<code>08/04/2022</code>) at
<code>07:55</code> and <code>11:21</code> and a third flight was
conducted 2 days later at <code>16:05</code>. Here’s the metadata file
for flights conducted. Below is the metadata for all flights</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify folder where the package data is stored</span></span>
<span><span class="va">folder</span> <span class="op">&lt;-</span> <span class="st">"C:/Users/ggarc/OneDrive/research/throne/"</span> <span class="co"># modify this to local path</span></span>
<span></span>
<span><span class="co"># load the metadata file for all flights</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">folder</span>, <span class="st">"case_study_data/c_flights_metadata.RData"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show metadata</span></span>
<span><span class="va">c_flights_metadata</span></span></code></pre></div>
<pre><code><span><span class="co">##    flight_id     date time_start time_end</span></span>
<span><span class="co">## 1 c_flight_1 8/6/2022      16:05    16:28</span></span>
<span><span class="co">## 2 c_flight_2 8/4/2022      11:21    11:45</span></span>
<span><span class="co">## 3 c_flight_3 8/4/2022       7:55     8:19</span></span></code></pre>
<p>All flights were processed using the software <code>Pix4D</code>
following the steps we present in the <a href="https://ggcostoya.github.io/throne/articles/collect_n_process_thermal_images.html">Collecting
and process thermal images vignette</a> included as part of the
<code>throne</code> documentation to obtain 3 thermal orthomosaics
(i.e., <code>.tif</code> files).</p>
</div>
<div class="section level3">
<h3 id="collect-and-process-operative-temperature-data">Collect and process operative temperature data<a class="anchor" aria-label="anchor" href="#collect-and-process-operative-temperature-data"></a>
</h3>
<p>We 3D printed 150 operative temperature models using ABS plastic of
the same shape, size and painted them to match the reflective properties
of the western fence lizard. Inside of each model, we placed a
Thermocron iButton logger set to record temperature every 60 minutes. We
deployed these OTMs randomly throughout the site as, at the time, we did
not have the expertise necessary for a more informed deployment.
Fortunately, the sheer number of OTMs enabled us to capture a wide
enough range of micro habitats.</p>
<div class="figure" style="text-align: center">
<img src="images/otm_model.png" alt="An operative temperature model of the type used for this study." width="60%"><p class="caption">
An operative temperature model of the type used for this study.
</p>
</div>
<p>The OTM metadata file we assembled looked like:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load metadata file </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">folder</span>, <span class="st">"case_study_data/c_otms_metadata.RData"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show metadata </span></span>
<span><span class="va">c_otms_metadata</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 150 × 3</span></span>
<span><span class="co">##    otm_id latitude longitude</span></span>
<span><span class="co">##    &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">##  1 H1         39.7     -119.</span></span>
<span><span class="co">##  2 H2         39.7     -119.</span></span>
<span><span class="co">##  3 H3         39.7     -119.</span></span>
<span><span class="co">##  4 H4         39.7     -119.</span></span>
<span><span class="co">##  5 H5         39.7     -119.</span></span>
<span><span class="co">##  6 H6         39.7     -119.</span></span>
<span><span class="co">##  7 H7         39.7     -119.</span></span>
<span><span class="co">##  8 H8         39.7     -119.</span></span>
<span><span class="co">##  9 H9         39.7     -119.</span></span>
<span><span class="co">## 10 H10        39.7     -119.</span></span>
<span><span class="co">## # ℹ 140 more rows</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="r-workflow">R workflow<a class="anchor" aria-label="anchor" href="#r-workflow"></a>
</h2>
<div class="section level3">
<h3 id="reading-and-processing-flights-data">Reading and processing flights data<a class="anchor" aria-label="anchor" href="#reading-and-processing-flights-data"></a>
</h3>
<p>Following the <code>R</code> workflow specified in the
<code>throne</code> package, the first step is to read and process the
flights data. An important part of this step is to specify the
<code>resolution</code> argument which will set the spatial resolution
of each of the tiles in the final thermal landscape prediction. For this
example, we choose to set <code>resolution = 1.5</code>, which is
representative of a micro habitat a lizard might be experiencing. We
read and process the flights data using the
<code>rnp_flights_data</code> function as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The code below is an example of how to read and process the flights data, DO NOT RUN ##</span></span>
<span></span>
<span><span class="co"># set files path</span></span>
<span><span class="va">flight_files_path</span> <span class="op">&lt;-</span> <span class="st">"x"</span> <span class="co"># This would be a folder within the user's computer, not specified here</span></span>
<span></span>
<span><span class="co"># read and process flights data (assuming that the metadata file is the one that was prevously loaded)</span></span>
<span><span class="va">c_flights_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rnp_flights_data.html">rnp_flights_data</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">flight_files_path</span>,</span>
<span>                                   metadata <span class="op">=</span> <span class="va">c_flights_metadata</span>,</span>
<span>                                   resolution <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span></code></pre></div>
<p>The outcome will be a flights data <code>tibble</code> storing all of
surface temperature (<code>surf_temp</code>) measurements collected
across all flights:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">c_flights_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            x       y surf_temp year doy mod_start mod_end</span></span>
<span><span class="co">## 163 289237.2 4402770  7.102429 2022 218       965     988</span></span>
<span><span class="co">## 164 289238.4 4402770 20.579145 2022 218       965     988</span></span>
<span><span class="co">## 165 289239.6 4402770 20.628806 2022 218       965     988</span></span>
<span><span class="co">## 166 289240.8 4402770 19.866348 2022 218       965     988</span></span>
<span><span class="co">## 167 289242.0 4402770 20.161145 2022 218       965     988</span></span>
<span><span class="co">## 168 289243.2 4402770 20.978074 2022 218       965     988</span></span></code></pre>
<p>We can plot this data using <code>ggplot2</code> tools to already get
a sense of the thermal characteristics of the study area:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_flights_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>hour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">mod_start</span><span class="op">/</span><span class="fl">60</span><span class="op">)</span>,<span class="st">":"</span>, <span class="va">mod_start</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">mod_start</span><span class="op">/</span><span class="fl">60</span><span class="op">)</span> <span class="op">*</span> <span class="fl">60</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>hour <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">hour</span>, <span class="va">mod_start</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">surf_temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"magma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">hour</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Surface temperature (°C)"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<p><img src="images/plot_c_flights_data-1.png" alt="plot of chunk plot c_flights_data"></p>
</div>
</div>
<div class="section level3">
<h3 id="reading-and-processing-otms-data">Reading and processing OTMs data<a class="anchor" aria-label="anchor" href="#reading-and-processing-otms-data"></a>
</h3>
<p>The next step would be to read and process the data collected via the
OTMs. We can do this through the <code>rnp_otms_data</code> function
from the <code>throne</code> package. Before we do that, we should check
the structure of our raw OTM <code>.csv</code> files. In this example
they look like this:</p>
<pre><code><span><span class="co">##     raw_date_time temp otm</span></span>
<span><span class="co">## 1 6/13/2022 14:18 27.0 H22</span></span>
<span><span class="co">## 2 6/13/2022 15:18 18.0 H22</span></span>
<span><span class="co">## 3 6/13/2022 16:18 21.5 H22</span></span>
<span><span class="co">## 4 6/13/2022 17:18 16.0 H22</span></span>
<span><span class="co">## 5 6/13/2022 18:18 10.0 H22</span></span>
<span><span class="co">## 6 6/13/2022 19:18  8.0 H22</span></span></code></pre>
<p>By taking a look at this (and other files) we can tell that there is
no need to skip any rows when reading them as <code>.csv</code> which
means that we can set the <code>rows_skip</code> argument of
<code>rnp_otms_data</code> to <code>0</code>, such that it can start
reading from the first row. We can also see that the column
<code>raw_data_time</code> contains information on both the date and the
time of each measurement and thus, that we should set the
<code>date_col</code> argument to <code>1</code>. We could also specify
<code>time_col = 1</code>, but that’s not necessary as if no
<code>time_col</code> is specified, <code>rnp_flights_data</code> will
assume that <code>date_col = time_col</code>. Lastly, we can see from
this file that the operative temperature measurements are stored in the
second column and that, as a result, we should set the
<code>op_temp_col</code> argument to <code>2</code>. With this in mind,
we can read and process the OTM data as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The code below is an example of how to read and process the flights data, DO NOT RUN ##</span></span>
<span></span>
<span><span class="co"># specify the path to where the OTM .csv files are stored</span></span>
<span><span class="va">otm_files_path</span> <span class="op">&lt;-</span> <span class="st">"x"</span> <span class="co"># This would be a folder within the user's computer, not specified here</span></span>
<span></span>
<span><span class="co"># read and process OTMs data (using the metadata file that was previously loaded)</span></span>
<span><span class="va">c_otms_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rnp_otms_data.html">rnp_otms_data</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">otm_files_path</span>,</span>
<span>                             metadata <span class="op">=</span> <span class="va">c_otms_metadata</span>,</span>
<span>                             rows_skip <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                             date_col <span class="op">=</span> <span class="fl">1</span>, <span class="co"># same as time_col</span></span>
<span>                             op_temp_col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>The outcome will be an OTM data <code>tibble</code> containing all
the observations made by all OTMs:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">c_otms_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   otm_id year doy  mod op_temp latitude longitude        x       y</span></span>
<span><span class="co">## 1     H1 2022 164  850    17.0 39.74506 -119.4597 289251.9 4402355</span></span>
<span><span class="co">## 2     H1 2022 164  910    15.0 39.74506 -119.4597 289251.9 4402355</span></span>
<span><span class="co">## 3     H1 2022 164  970    17.0 39.74506 -119.4597 289251.9 4402355</span></span>
<span><span class="co">## 4     H1 2022 164 1030    16.0 39.74506 -119.4597 289251.9 4402355</span></span>
<span><span class="co">## 5     H1 2022 164 1090    15.5 39.74506 -119.4597 289251.9 4402355</span></span>
<span><span class="co">## 6     H1 2022 164 1150    13.0 39.74506 -119.4597 289251.9 4402355</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="generate-otm-spline-models">Generate OTM spline models<a class="anchor" aria-label="anchor" href="#generate-otm-spline-models"></a>
</h3>
<p>Having read the OTMs data, the next step is to define <strong>cubic
splines models</strong> to describe the thermal dynamics of each OTM on
each <code>doy</code> during its deployment. To do this, we can use the
<code>gen_otm_splines</code> function of the <code>throne</code>
package. For this step, a crucial user input is the <code>knot_p</code>
parameter which will determine the “wiggliness” of the spline model. <a href="https://ggcostoya.github.io/throne/articles/rnp_otms_data_gen_otm_splines.html#choosing-the-appropriate-knot_p-value">Choosing
th appropriate <code>knot_p</code> value</a> is dependent on the
recording frequency at which we set our OTMs and the thermal properties
of the organism of interest itself. Based on the thermal properties of
our organism of interest (<em>Sceloporus occidentalis</em>), we would
ideally a spline model with 1 knot for every 15 minutes, which is the
typical time this lizard takes to acclimate to a new temperature.
However, OTMs recorded at a frequency of 1 observation / hour. At this
low frequency, we want to preserve as much information on the thermal
fluctuations of the OTM as possible which is why setting
<code>knot_p = 1</code> works fine. To obtain the spline models, we can
simply run:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_otms_splines</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_otm_splines.html">gen_otm_splines</a></span><span class="op">(</span>otm_data <span class="op">=</span> <span class="va">c_otms_data</span>, knot_p <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Which returns a nested <code>tibble</code> with all
<code>otm_id</code> &amp; <code>doy</code> specific models (in the
column <code>spline</code>):</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_otms_splines</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 11,008 × 8</span></span>
<span><span class="co">##    otm_id  year   doy latitude longitude       x        y spline    </span></span>
<span><span class="co">##    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;list&gt;    </span></span>
<span><span class="co">##  1 H1      2022   164     39.7     -119. 289252. 4402355. &lt;smth.spl&gt;</span></span>
<span><span class="co">##  2 H1      2022   165     39.7     -119. 289252. 4402355. &lt;smth.spl&gt;</span></span>
<span><span class="co">##  3 H1      2022   166     39.7     -119. 289252. 4402355. &lt;smth.spl&gt;</span></span>
<span><span class="co">##  4 H1      2022   167     39.7     -119. 289252. 4402355. &lt;smth.spl&gt;</span></span>
<span><span class="co">##  5 H1      2022   168     39.7     -119. 289252. 4402355. &lt;smth.spl&gt;</span></span>
<span><span class="co">##  6 H1      2022   169     39.7     -119. 289252. 4402355. &lt;smth.spl&gt;</span></span>
<span><span class="co">##  7 H1      2022   170     39.7     -119. 289252. 4402355. &lt;smth.spl&gt;</span></span>
<span><span class="co">##  8 H1      2022   171     39.7     -119. 289252. 4402355. &lt;smth.spl&gt;</span></span>
<span><span class="co">##  9 H1      2022   172     39.7     -119. 289252. 4402355. &lt;smth.spl&gt;</span></span>
<span><span class="co">## 10 H1      2022   173     39.7     -119. 289252. 4402355. &lt;smth.spl&gt;</span></span>
<span><span class="co">## # ℹ 10,998 more rows</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="correcting-flight-data">Correcting flight data<a class="anchor" aria-label="anchor" href="#correcting-flight-data"></a>
</h3>
<p>The next step in the <code>throne</code> package workflow is to
correct the data obtained via flights using OTM flights data. To achieve
this, we will use the <code>correct_flighs_data</code> function. To use
the function, we will specify that we want a time correction
(<code>time_correction = TRUE</code>), that we want the mean to be the
metric used for the time correction
(<code>time_correction_metric = "mean"</code>) but that we do not want a
flight-specific correction
(<code>flight_specific_correction = FALSE</code>, the default
parameter):</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_flights_data_corr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/correct_flights_data.html">correct_flights_data</a></span><span class="op">(</span>flights_data <span class="op">=</span> <span class="va">c_flights_data</span>, </span>
<span>                                            otm_splines <span class="op">=</span> <span class="va">c_otms_splines</span>,</span>
<span>                                            time_correction <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                            time_correction_metric <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                                            flight_specific_correction <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>We can visualize below the effects of the correction process
(<code>Post-correction</code>) with respect to the data from the
original flights (<code>Pre-correction</code>).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the flights pre-correction</span></span>
<span><span class="va">pre_corr</span> <span class="op">&lt;-</span> <span class="va">c_flights_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>hour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">mod_start</span><span class="op">/</span><span class="fl">60</span><span class="op">)</span>,<span class="st">":"</span>, <span class="va">mod_start</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">mod_start</span><span class="op">/</span><span class="fl">60</span><span class="op">)</span> <span class="op">*</span> <span class="fl">60</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>hour <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">hour</span>, <span class="va">mod_start</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">surf_temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"magma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">hour</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Pre-correction (Surface Temperature)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Temperature (°C)"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the flights post-correction</span></span>
<span><span class="va">post_corr</span> <span class="op">&lt;-</span> <span class="va">c_flights_data_corr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>hour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">mod_start</span><span class="op">/</span><span class="fl">60</span><span class="op">)</span>,<span class="st">":"</span>, <span class="va">mod_start</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">mod_start</span><span class="op">/</span><span class="fl">60</span><span class="op">)</span> <span class="op">*</span> <span class="fl">60</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>hour <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">hour</span>, <span class="va">mod_start</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">op_temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"magma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">hour</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Post-correction (Operative Temperature)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Temperature (°C)"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggarrange</span><span class="op">(</span><span class="va">pre_corr</span>, <span class="va">post_corr</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">1</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<p><img src="images/plot_comparison_pre-post_flight_correction-1.png" alt="plot of chunk plot comparison pre-post flight correction"></p>
</div>
</div>
<div class="section level3">
<h3 id="match-flight-to-otm-data">Match flight to OTM data<a class="anchor" aria-label="anchor" href="#match-flight-to-otm-data"></a>
</h3>
<p>The last step before being able to predict thermal landscapes is to
match the thermal dynamics of each of the tiles within our corrected
flights data to the dynamics of a given OTM. To achieve this, we can use
the <code>match_data</code> function from the <code>throne</code>
package. To use this function, two user-specific inputs are needed:
<code>coverage_per</code> and <code>error_max</code>. The first one
determines the degree of coverage across multiple flights that a tile
needs to have in order to be considered in the matching process. As seen
below, our flights had a particularly good overlap:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_flights_data_corr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">y</span>, <span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>coverage_per <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>coverage_per <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">coverage_per</span> <span class="op">&gt;</span> <span class="fl">100</span>, <span class="fl">100</span>, <span class="va">coverage_per</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">coverage_per</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Coverage (%)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<p><img src="images/plot%20coverage%20across%20flights-1.png" alt="plot of chunk plot coverage across flights"></p>
</div>
<p>In our case, we can set <code>coverage_per = 1</code> to ensure that
only areas covered across all flights are considered although, for a
greater number of flights we would recommend setting
<code>coverage_per = 0.9</code>. The second input
(<code>error_max</code>) determines the maximum average absolute error
between a tile and OTM dynamics that should be specified as a threshold
for the matching. If the average absolute difference between a tile’s
thermal dynamics and the OTM that best describes it is &gt;
<code>error_max</code>, that tile is not matched to any OTM and thus
should not be considered. In this case, we will follow our own
specifications and set <code>error_max = 5</code>. Now, we can run the
<code>match_data</code> function as follows:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_matches</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_data.html">match_data</a></span><span class="op">(</span>flights_data <span class="op">=</span> <span class="va">c_flights_data_corr</span>, otm_splines <span class="op">=</span> <span class="va">c_otms_splines</span>, coverage_per <span class="op">=</span> <span class="fl">1</span>, error_max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p>The result will be a matches <code>tibble</code> with the OTM that
best describes the dynamics of each tile in the site. In the figure
below, each tile is colored according to the <code>otm_id</code> that
best represents it’s thermal dynamics.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">c_matches</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            x       y coverage      error otm_id</span></span>
<span><span class="co">## 63  289065.6 4402654        1 11.8962132   H129</span></span>
<span><span class="co">## 114 289066.8 4402654        1  1.5364074    H39</span></span>
<span><span class="co">## 184 289068.0 4402654        1  0.4646073    H89</span></span>
<span><span class="co">## 220 289068.0 4402686        1 10.3619358    H93</span></span>
<span><span class="co">## 279 289069.2 4402654        1  0.2772866    H49</span></span>
<span><span class="co">## 328 289069.2 4402686        1  2.7483973    H32</span></span></code></pre>
<p>We can visualize the results of the matching step as shown below:</p>
<div class="figure" style="text-align: center">
<p><img src="images/plot_assigned_OTM_id_map-1.png" alt="plot of chunk plot assigned OTM id map"></p>
</div>
<p>In the plot above, each tile is color coded to match the ID of the
OTM that best described it (each color is a unique OTM). Without need
for user-specified input, the matching process identified the topography
of the terrain, assigning different OTMs to the eastern and western
facing sides of the ridge that divides the site.</p>
<div class="figure" style="text-align: center">
<p><img src="images/plot%20matching%20error-1.png" alt="plot of chunk plot matching error"></p>
</div>
<p>The matching bias (<code>error</code>) was generally very low (a good
thing) and the number of tiles that could not be assigned to any OTM
when setting <code>error_max = 5</code> was minimal (tiles highlighted
in black).</p>
</div>
<div class="section level3">
<h3 id="predicting-thermal-landscapes">Predicting thermal landscapes<a class="anchor" aria-label="anchor" href="#predicting-thermal-landscapes"></a>
</h3>
<p>Using all the above, we can finally predict the thermal landscapes of
the site using the <code>predict_thermal_landscape</code> function of
the <code>throne</code> package. As an example, below we predict the
thermal landscape every hour between 6 AM (<code>mod = 360</code>) and 9
PM (<code>mod = 1260</code>) on August 10th (<code>doy = 222</code>). To
obtain this prediction we’d simply run:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_thermal_landscape.html">predict_thermal_landscape</a></span><span class="op">(</span></span>
<span>  matches <span class="op">=</span> <span class="va">c_matches</span>, </span>
<span>  otm_splines <span class="op">=</span> <span class="va">c_otms_splines</span>,</span>
<span>  doy <span class="op">=</span> <span class="fl">222</span>,</span>
<span>  mod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">360</span>,<span class="fl">1260</span>, by <span class="op">=</span> <span class="fl">60</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can visualize some predictions as follows:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_prediction</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">mod</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span><span class="op">*</span><span class="fl">60</span>, <span class="fl">9</span><span class="op">*</span><span class="fl">60</span>, <span class="fl">13</span><span class="op">*</span><span class="fl">60</span>, <span class="fl">19</span><span class="op">*</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">pred_op_temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"magma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">mod</span><span class="op">/</span><span class="fl">60</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Predicted Operative Temperature (°C)"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<p><img src="images/visualize%20thermal%20landscape%20prediction-1.png" alt="plot of chunk visualize thermal landscape prediction"></p>
</div>
<p>Each panel above shows the predicted thermal landscape of the entire
site at a given hour of the day. Tiles colored in white are tiles for
which no OTM could be assigned during the matching process.</p>
</div>
</div>
<div class="section level2">
<h2 id="ecological-application-of-the-method">Ecological application of the method<a class="anchor" aria-label="anchor" href="#ecological-application-of-the-method"></a>
</h2>
<p>Once we obtain the prediction of the thermal landscape we can use it
to infer characteristics of the thermal environments experienced by the
organism of interest. As an example, here we integrate the thermal
landscape prediction with the spatial distribution of the home ranges of
10 individual lizards of our population of interest. Below is the
mark-recapture example data set we will use:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lizard_mr</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 36 × 7</span></span>
<span><span class="co">##    id    sex    year   doy   mod        y       x</span></span>
<span><span class="co">##    &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">##  1 H005  M      2022   175   720 4402397. 289268.</span></span>
<span><span class="co">##  2 H005  M      2022   200   767 4402413. 289264.</span></span>
<span><span class="co">##  3 H005  M      2022   173   678 4402417. 289269.</span></span>
<span><span class="co">##  4 H005  M      2022   180   720 4402415. 289295.</span></span>
<span><span class="co">##  5 H009  M      2022   193   704 4402510. 289395.</span></span>
<span><span class="co">##  6 H009  M      2022   216   630 4402492. 289327.</span></span>
<span><span class="co">##  7 H009  M      2022   173   753 4402553. 289316.</span></span>
<span><span class="co">##  8 H009  M      2022   214   784 4402560. 289324.</span></span>
<span><span class="co">##  9 H020  M      2023   166   765 4402683. 289237.</span></span>
<span><span class="co">## 10 H020  M      2022   195   774 4402683. 289234.</span></span>
<span><span class="co">## # ℹ 26 more rows</span></span></code></pre>
<p>Our spatially explicit mark-recapture data set allows us to estimate
each individual’s territory as an individual-specific minimum convex
polygon. We can plot each individual’s home range on top of the
predicted thermal landscape at 10 AM as an example:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load necessary package to add a second fill scale</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://eliocamp.github.io/ggnewscale/" class="external-link">ggnewscale</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plotting</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span>data <span class="op">=</span> <span class="va">example_prediction</span> <span class="op">|&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">mod</span> <span class="op">==</span> <span class="fl">10</span><span class="op">*</span><span class="fl">60</span><span class="op">)</span>,</span>
<span>              <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">pred_op_temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"magma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://eliocamp.github.io/ggnewscale/reference/new_scale.html" class="external-link">new_scale_fill</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lizard_mr</span>,</span>
<span>               <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">id</span><span class="op">)</span>,</span>
<span>               alpha <span class="op">=</span> <span class="fl">0.75</span>, col <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<p><img src="images/plot%20lizard%20territories%20on%20top%20of%20thermal%20landscape-1.png" alt="plot of chunk plot lizard territories on top of thermal landscape"></p>
</div>
<p>We can hen calculate the average predicted operative temperature
experience by each individual within their home range as:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># holder object</span></span>
<span><span class="va">example_pred_lizards</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>, mod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>, pred_op_temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get unique lizard id list</span></span>
<span><span class="va">lizard_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">lizard_mr</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># loop to filter the prediction for each unique lizard's home range</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lizard_list</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># select polygon for the lizard</span></span>
<span>  <span class="va">lizard_polygon</span> <span class="op">&lt;-</span> <span class="va">lizard_mr</span> <span class="op">|&gt;</span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="va">lizard_list</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># filter thermal landscape for rough home-range for each lizard</span></span>
<span>  <span class="va">rough_home_range</span> <span class="op">&lt;-</span> <span class="va">example_prediction</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">lizard_polygon</span><span class="op">$</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">lizard_polygon</span><span class="op">$</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>             <span class="va">y</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">lizard_polygon</span><span class="op">$</span><span class="va">y</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">y</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">lizard_polygon</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">mutate</span><span class="op">(</span>id <span class="op">=</span> <span class="va">lizard_list</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">id</span>, <span class="va">y</span>, <span class="va">x</span>, <span class="va">mod</span>, <span class="va">pred_op_temp</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># bind to holder object</span></span>
<span>  <span class="va">example_pred_lizards</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">example_pred_lizards</span>, <span class="va">rough_home_range</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<blockquote>
<p><strong>NOTE</strong>: The above is an approximation, for more
detailed (and accurate) method to estimate individual home ranges please
consider checking <a href="https://cengel.github.io/R-spatial/" class="external-link">“Using
spatial data with R”</a></p>
</blockquote>
<p>We can visualize the average predicted operative temperature
experienced by each individual within their home range as follows:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_pred_lizards</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pred_op_temp</span>, y <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>col <span class="op">=</span> <span class="va">id</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Lizard ID"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Mean day-time operative temperature within home range (C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## No summary function supplied, defaulting to `mean_se()`</span></span></code></pre>
<div class="figure" style="text-align: center">
<p><img src="images/plot_average_daytime_op_temp_in_each_lizard_territory-1.png" alt="plot of chunk plot average daytime op temp in each lizard territory"></p>
</div>
<p>As seen above, individuals experience substantially different thermal
environments on average, but how does this translate by hour of the
day?:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_pred_lizards</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mod</span><span class="op">/</span><span class="fl">60</span>, y <span class="op">=</span> <span class="va">pred_op_temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>col <span class="op">=</span> <span class="va">id</span><span class="op">)</span>, geom <span class="op">=</span> <span class="st">"line"</span>, linewidth <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"line"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Mean day-time operative temperature within home range (C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Hour of the day"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<p><img src="images/plot%20mean%20operative%20temp%20in%20lizard%20territory%20by%20hour%20of%20the%20day-1.png" alt="plot of chunk plot mean operative temp in lizard territory by hour of the day"></p>
</div>
<p>Lastly, we can consider what is the ecological relevance of the
different conditions experienced by each individual by examining the
percentage of their home range that falls within their <strong>preferred
temperature</strong> (<span class="math inline">\(T_{pref}\)</span>),
which for this species falls between 30 and 35 C. We can visualize this
percentage by hour of the day as follows:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_pred_lizards</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>at_tpref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">pred_op_temp</span> <span class="op">&gt;=</span> <span class="fl">30</span> <span class="op">&amp;</span> <span class="va">pred_op_temp</span> <span class="op">&lt;=</span> <span class="fl">35</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">mod</span>, <span class="va">id</span><span class="op">)</span> <span class="op">|&gt;</span><span class="fu">summarise</span><span class="op">(</span>at_tpref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">at_tpref</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mod</span> <span class="op">/</span> <span class="fl">60</span>, y <span class="op">=</span> <span class="va">at_tpref</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>col <span class="op">=</span> <span class="va">id</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"line"</span>, col <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"% of home range within 30 - 35 C"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Hour of the day"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<p><img src="images/plot%20percentage%20of%20home%20range%20within%20thermal%20optima%20range-1.png" alt="plot of chunk plot percentage of home range within thermal optima range"></p>
</div>
<p>Individuals differ substantially on the percentage of their home
range that falls within their preferred temperature range. This
information can be used to infer the potential impact of the thermal
landscape on the fitness of each individual.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Karla Alujević, Guillermo Garcia-Costoya, Noa Ratia, Emma Schmitz, Russell D. Godkin, Jelena Bujan, Akhila C. Gopal, Michael Logan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
