<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="throne">
<title>Predicting Thermal Landscapes • throne</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Predicting Thermal Landscapes">
<meta property="og:description" content="throne">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">throne</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/overview.html">Overview</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-field-setup">Field setup</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-field-setup">
    <a class="dropdown-item" href="../articles/drone_setup.html">Drones</a>
    <a class="dropdown-item" href="../articles/otm_setup.html">OTMs</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-r-workflow">R Workflow</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-r-workflow">
    <a class="dropdown-item" href="../articles/rnp_flights_data.html">Reading and processing flight data</a>
    <a class="dropdown-item" href="../articles/rnp_otms_data_gen_otm_splines.html">Reading and processing OTM data</a>
    <a class="dropdown-item" href="../articles/correcting_flight_data.html">Correcting flight data</a>
    <a class="dropdown-item" href="../articles/predicting_thermal_landscapes.html">Predicting thermal landscapes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/case_study.html">Case study</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Predicting Thermal Landscapes</h1>
            
      
      
      <div class="d-none name"><code>predicting_thermal_landscapes.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In this vignette, our goal is to illustrate the process behind the
final step in the workflow of the <code>throne</code> package, the
prediction of spatio-temporally complete thermal landscapes. To achieve
this, <code>throne</code> uses two functions: <code>match_data</code>
and <code>predict_thermal_landscpe</code>. The first allows the user to
match the thermal dynamics of a given tile within their site (i.e., a
unique <code>latitude</code> and <code>longitude</code>) as measured
across multiple flights with those of an <strong>operative temperature
model</strong> (<strong>OTM</strong>). The second, uses this matches
data set and combines it with information from date &amp; OTM specific
cubic spline models (obtained using the <code>gen_otm_splines</code>)
function in this package to predict the temperature of each tile on the
site at any moment in time while the OTMs were deployed in the field. In
the context of the overall workflow of the package, this is the section
that is covered in this vignette:</p>
<p><img src="images/predict_thermal_landscapes_workflow.png" width="80%" style="display: block; margin: auto;"></p>
<p>Finally, we also provide some information on the predictive accuracy
of this method which, as we present in the accompanying manuscript, is
very high.</p>
</div>
<div class="section level2">
<h2 id="the-match_data-function">The <code>match_data</code> function<a class="anchor" aria-label="anchor" href="#the-match_data-function"></a>
</h2>
<p>The <code>match_data</code> function matches the thermal dynamics of
specific tiles (i.e., unique <code>latitude</code> and
<code>longitude</code> combinations) collected across multiple flights
to the thermal dynamics of an operative temperature model (OTM). To do
so, the function takes in the following inputs inherited from previous
functions :</p>
<ol style="list-style-type: decimal">
<li>A <code>flights_data</code> <code>tibble</code> obtained using the
<code>rnp_flights_data</code>. We <strong>strongly</strong> recommend
that this <code>tibble</code> undergoes correction using the
<code>correct_flights_data</code> function in order to ensure that the
both the <code>flights_data</code> <code>tibble</code> and the OTMs are
on an operative temperature scale. However, the function will allow the
user to use an uncorrected <code>flights_data</code> <code>tibble</code>
if they so choose.</li>
<li>An <code>otm_splines</code> complex <code>tibble</code> obtained
using the <code>gen_otm_splines</code> function.</li>
</ol>
<p>Additionally, the <code>match_data</code> also requires
<code>2</code> user specified inputs:</p>
<ol style="list-style-type: decimal">
<li>
<code>coverage_per</code>, a numeric value between 0 - 1 indicating
the minimum coverage that a tile should have across all flights provided
in order t be included in the matching. The need for this input can be
easily visualized by overlapping the area covered by multiple flights in
the provided example <code>flights_data</code> (see image below). Due to
the unique conditions during each of the <code>34</code> flights we
conducted to perform this study (e.g., wind etc.), the area covered be
each flights was variable specially when focusing around the edges.
Nonetheless, we foresaw this effect which is why <strong>we ensured that
the area covered by each flight would be much larger than the area of
interest for our study</strong>, a precaution we recommend all users of
this package to follow. Our goal was that the area where we had OTMs
would be covered by flights and, as seen above, all OTMs deployed on the
ground (black dots) fell on areas that were covered by the vast majority
of our flights. <strong>As a general guideline, we recommend setting
<code>coverage_per &gt;= 0.9</code></strong>
</li>
</ol>
<p><img src="predicting_thermal_landscapes_files/figure-html/unnamed-chunk-2-1.png" width="576" style="display: block; margin: auto;"></p>
<ol start="2" style="list-style-type: decimal">
<li>
<code>error_max</code>, the maximum error between temperature
measurements of a tile and the OTM that best represents it, which we
develop on more next.</li>
</ol>
<p>To match tiles with OTMs that best describe their thermal dynamics,
the <code>match_data</code> function goes through the following general
steps:</p>
<ol style="list-style-type: decimal">
<li><p>It calculates the coverage across all flights for every single
tile covered and selects only those tiles that have bee covered as much
or more as the <code>coverage_per</code> argument specifies.</p></li>
<li><p>For each tile, calculate the average absolute error between the
temperature measurements of that tile during each flight and the
temperature measurements made by every OTMs at the exact same time each
flight took place.</p></li>
<li><p>Select the OTM that minimizes the error between the tile’s and
the OTMs measurements. In the figure below we illustrate the logic of
this approach. The black dots indicate the temperature measurements
associated with a given tile (note that these measurements are corrected
using the <code>correct_flights_data</code> function) across all flights
that occurred in the days of the year (<code>doy</code>) 236, 237 and
238. The red and blue lines indicate the temperatures predicted by the
spline model of 2 OTMs for those same <code>doy</code>. In this case,
the <code>match_data</code> function would choose <code>OTM25</code> to
better represent the dynamics of that tile as the average different
between each of the tile’s temperature measurements and those estimated
by the cubic spline model for that OTM is much smaller than that for
<code>OTM05</code>.</p></li>
</ol>
<p><img src="predicting_thermal_landscapes_files/figure-html/unnamed-chunk-3-1.png" width="768" style="display: block; margin: auto;"></p>
<blockquote>
<p><strong>NOTE</strong>: The distance between the tile and the OTM is
<strong>NOT</strong> weighted for during this step. This is because an
OTM that is not necessarily the closest to that tile might actually be
able to represent its thermal dynamics much better than one that is
closer. For example, a tile that contains a tree might be represented by
an OTM that is deployed inside of a tree at 100 m than one that is on a
southern facing slope only 2 m away. This approach extends even to a the
same tile where an OTM is deployed. Imagine a tile that is mostly facing
south but that has a small bush on it. If an OTM is placed precisely on
that bush, its thermal dynamics might not be representative of the
average dynamics of that tile and an OTM placed elsewhere might actually
represent that tile better. In the figure below we show the results of
matching our example data set, in only 5 cases the same OTM that was on
a tile best described its thermal dynamics.</p>
</blockquote>
<p><img src="predicting_thermal_landscapes_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;"></p>
<ol start="4" style="list-style-type: decimal">
<li>If the minimum error is above a certain threshold indicated by he
<code>error_max</code> parameter do not assign any OTM to a tile. In the
figure below we show the results of implementing this step with the
areas marked in dark blue indicating tiles for which no one OTM could
best describe it without exceeding the threshold imposed by
<code>error_max</code>. It is also important to note that these
“problematic” tiles are far from the area of interest for this study
(where the OTMs, indicated by black dots, where deployed) and that in
this area the error is minimized.</li>
</ol>
<p><img src="predicting_thermal_landscapes_files/figure-html/unnamed-chunk-5-1.png" width="576" style="display: block; margin: auto;"></p>
<blockquote>
<p><strong>NOTE</strong>: The figure above shades in light gray all
tiles that were covered by at least 1 flights but that were not covered
in at least 90% of flights. As seen above, the high-coverage area is
much smaller than the total area covered in flights.</p>
</blockquote>
<p>The resulting <code>matches</code> <code>tibble</code> will have an
<code>otm_id</code> column indicating the OTM that best describes a
given tile (i.e., a combination o <code>latitude</code> and
<code>longitude</code>) as well as a column for the matching
<code>error</code> for the user to check if desired. In rows where
<code>error &gt; error_max</code> the <code>otm_id</code> will be
specified as <code>NA</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matches</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6,386 × 4</span></span></span>
<span><span class="co">##    latitude longitude otm_id error</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>     39.9     -<span style="color: #BB0000;">120.</span> OTM26   3.60</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>     39.9     -<span style="color: #BB0000;">120.</span> OTM26   3.61</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>     39.9     -<span style="color: #BB0000;">120.</span> OTM14   2.96</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>     39.9     -<span style="color: #BB0000;">120.</span> OTM26   2.93</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>     39.9     -<span style="color: #BB0000;">120.</span> OTM26   3.14</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>     39.9     -<span style="color: #BB0000;">120.</span> OTM02   2.45</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>     39.9     -<span style="color: #BB0000;">120.</span> OTM26   2.61</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>     39.9     -<span style="color: #BB0000;">120.</span> OTM26   2.71</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>     39.9     -<span style="color: #BB0000;">120.</span> OTM26   2.50</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>     39.9     -<span style="color: #BB0000;">120.</span> OTM26   2.98</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 6,376 more rows</span></span></span></code></pre>
<p>From this <code>matches</code> data we gather some interesting
findings. Including that:</p>
<ol style="list-style-type: decimal">
<li>Very few OTMs are needed to explain the majority of the sites
thermal dynamics. In the example data set, only <code>5</code> out of
the <code>33</code> OTMs deployed were needed to explain more than
&gt;50% of the variability of the site and only <code>21</code> to
explain &gt;95%.</li>
</ol>
<p><img src="predicting_thermal_landscapes_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></p>
<ol start="2" style="list-style-type: decimal">
<li>The matching mechanism will automatically match tiles with a given
orientation to OTMs deployed in a tile with the same orientation. As
seen below and considering that the site is plotted in a N-S
orientation, we can, for example, that OTMs facing <code>W</code> best
described tiles that were on a western slope and so on.</li>
</ol>
<p><img src="predicting_thermal_landscapes_files/figure-html/unnamed-chunk-8-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="predicting-thermal-landscapes">Predicting thermal landscapes<a class="anchor" aria-label="anchor" href="#predicting-thermal-landscapes"></a>
</h2>
<p>The final step in the workflow of the <code>throne</code> package is
to predict thermal landscapes. To do this, the <code>thonre</code>
package includes the function <code>predict_thermal_landscape</code>
which takes in the following inherited inputs:</p>
<ol style="list-style-type: decimal">
<li><p>An <code>otm_splines</code> complex <code>tibble</code> obtained
through the <code>generate_otm_splines</code>.</p></li>
<li><p>A <code>matches</code> tibble associating tiles in a study area
with OTMs that best describe their thermal dynamics obtained using the
<code>match_data</code> function discussed above.</p></li>
</ol>
<p>In addition, the <code>predict_thermal_landscape</code> function will
require to new user-specified inputs:</p>
<ol style="list-style-type: decimal">
<li><p>The day of the year or <code>doy</code> (single or multiple) for
which a prediction should be generated.</p></li>
<li><p>The minute of the day or <code>mod</code> (single or multiple) in
the <code>doy</code> specified for which a prediction should be
generated.</p></li>
</ol>
<p>Once these inputs are specified, the function will go through the
following general steps:</p>
<ol style="list-style-type: decimal">
<li><p>Filter the provided <code>otm_splines</code> for splines
characterizing OTMs that are also present in the <code>matches</code>
<code>tibble</code> and among these select only models describing the
dynamics of that OTM on the <code>doy</code> (single or multiple)
specified as an argument of the function.</p></li>
<li><p>Predict the operative temperature at the specified
<code>mod</code> (single or multiple) and <code>doy</code> for all
OTMs.</p></li>
<li><p>Merge the operative temperature prediction with the
<code>matches</code> <code>tibble</code> to obtain a predicted operative
temperature for every single tile considered.</p></li>
</ol>
<p>Since all the necessary calculations have been carried out before
hand (i.e., generating the spline models, performing the matching
between tiles and OTMs etc.) the <code>predict_thermal_landscape</code>
function is relatively fast and allows the user to <strong>predict the
entire thermal landscape of their site at any moment while their OTMs
were deployed</strong>. For example, say that we want to obtain a
complete thermal landscape prediction every hour of the day for the
<code>doy = 237</code> (i.e., August 24th), one would simply run:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># obtain prediction</span></span>
<span><span class="va">prediction_237</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_thermal_landscape.html">predict_thermal_landscape</a></span><span class="op">(</span>matches <span class="op">=</span> <span class="va">matches</span>, otm_splines <span class="op">=</span> <span class="va">otms_splines</span>, </span>
<span>                                            doy <span class="op">=</span> <span class="fl">237</span>, mod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1440</span>, by <span class="op">=</span> <span class="fl">60</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "0.19 % of predictions were removed due to falling outside of the time when OTMs were recording"</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prediction_237</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 152,834 × 5</span></span></span>
<span><span class="co">##    latitude longitude   doy   mod pred_op_temp</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>     39.9     -<span style="color: #BB0000;">120.</span>   237  <span style="text-decoration: underline;">1</span>380         23.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>     39.9     -<span style="color: #BB0000;">120.</span>   237  <span style="text-decoration: underline;">1</span>320         22.8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>     39.9     -<span style="color: #BB0000;">120.</span>   237   900         36.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>     39.9     -<span style="color: #BB0000;">120.</span>   237  <span style="text-decoration: underline;">1</span>080         32.1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>     39.9     -<span style="color: #BB0000;">120.</span>   237  <span style="text-decoration: underline;">1</span>200         25.9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>     39.9     -<span style="color: #BB0000;">120.</span>   237  <span style="text-decoration: underline;">1</span>440         22.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>     39.9     -<span style="color: #BB0000;">120.</span>   237    60         21.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>     39.9     -<span style="color: #BB0000;">120.</span>   237     0         21.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>     39.9     -<span style="color: #BB0000;">120.</span>   237  <span style="text-decoration: underline;">1</span>260         24.9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>     39.9     -<span style="color: #BB0000;">120.</span>   237   660         34.6</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 152,824 more rows</span></span></span></code></pre>
<blockquote>
<p><strong>NOTE</strong>: The <code>predict_thermal_landscape</code>
function will not be able to predict thermal landscapes if the specified
time falls outside of the range when OTMs were measuring. To that end,
the function will also provide a warning indicating what % of
predictions were removing due to falling outside of the range when the
OTMs were recording.</p>
</blockquote>
<p>We can plot this prediction using regular <code>ggplot</code> tools
as easily as:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prediction_237</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, fill <span class="op">=</span> <span class="va">pred_op_temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"magma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">mod</span><span class="op">/</span><span class="fl">60</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, axis.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="st">"top"</span>,strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Predicted Operative Temperature (C)"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="predicting_thermal_landscapes_files/figure-html/unnamed-chunk-10-1.png" width="768" style="display: block; margin: auto;"></p>
<p>The plot above And when combined into a single image using tools from
the <a href="https://gganimate.com/" class="external-link"><code>gganimate</code></a>
package:</p>
<p><img src="images/dynamic_thermal_landscape.gif" width="60%" style="display: block; margin: auto;"></p>
<p>The <code>predict_thermal_landscape</code> function has unlimited
power to provide complete thermal landscape predictions at an
unprecedented level of detail.</p>
</div>
<div class="section level2">
<h2 id="predictive-accuracy">Predictive accuracy<a class="anchor" aria-label="anchor" href="#predictive-accuracy"></a>
</h2>
<p>As we discuss in the accompanying manuscript, this method is highly
accurate when predicting thermal landscapes. To that end, we performed a
validation to compare the predicted operative temperature for all tiles
containing OTMs using the <code>predict_thermal_landscape</code>
function to the operative temperatures recorded by the OTMs that were
actually on those tiles. The average prediction error (i.e.,
<code>pred_op_temp - op_temp</code>) was XX.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">val_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">knot_p</span> <span class="op">==</span> <span class="fl">1</span><span class="op">/</span><span class="fl">7.5</span>, <span class="va">n_flights</span> <span class="op">==</span> <span class="fl">34</span>, <span class="va">n_otms</span> <span class="op">==</span> <span class="fl">33</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">pred_op_temp</span> <span class="op">-</span> <span class="va">obs_op_temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">..density..</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"lightgray"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Prediction error (Predicted - Observed Operative Temp., C)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: The dot-dot notation (`..density..`) was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use `after_stat(density)` instead.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<p><img src="predicting_thermal_landscapes_files/figure-html/unnamed-chunk-12-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
