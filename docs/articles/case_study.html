<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="throne">
<title>Case study: Thermoregulation in high elevation lizards. • throne</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Case study: Thermoregulation in high elevation lizards.">
<meta property="og:description" content="throne">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">throne</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/overview.html">Overview</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-field-setup">Field setup</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-field-setup">
    <a class="dropdown-item" href="../articles/Drone_data.html">Drones</a>
    <a class="dropdown-item" href="../articles/OTM_data.html">OTMs</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-r-workflow">R Workflow</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-r-workflow">
    <a class="dropdown-item" href="../articles/rnp_flights_data.html">Reading and processing flight data</a>
    <a class="dropdown-item" href="../articles/rnp_otms_data_gen_otm_splines.html">Reading and processing OTM data</a>
    <a class="dropdown-item" href="../articles/correcting_flight_data.html">Correcting flight data</a>
    <a class="dropdown-item" href="../articles/predicting_thermal_landscapes.html">Predicting thermal landscapes</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/case_study.html">Case study</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Case study: Thermoregulation in high elevation lizards.</h1>
            
      
      
      <div class="d-none name"><code>case_study.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In this vignette we illustrate a case study to serve as an example on
how to use the tools provided by the <code>throne</code> package. In
this example we will be looking at a population of western fence lizards
(<em>Sceloporus occidentalis</em>) living at ~ 2400 m above sea level in
the Great Basin Desert of Northern Nevada.</p>
<p><img src="images/c_study_organism.png" width="80%" style="display: block; margin: auto;"></p>
<p><img src="images/c_study_site.jpg" width="80%" style="display: block; margin: auto;"></p>
<p>This population underwent mark-recapture during the summer of 2022.
All individuals were uniquely identified via toe-clipping and, upon each
capture the we recorded the location of each individual (i.e.,
<code>latitude</code> and <code>longitude</code>) using a Trimble Geo7x
GPS with an accuracy of ~0.5 <span class="math inline">\(m^2\)</span>,
and the time (i.e., <code>year</code>, day of the year or
<code>doy</code> and minute of the day or <code>mod</code>).
Additionally, for most lizards we recorded a body temperature
measurement (<code>tb</code>) by inserting a thermocouple probe into the
animal’s cloaca:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lizard_mr</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 170 × 8</span></span></span>
<span><span class="co">##    id    sex    year   doy   mod latitude longitude    tb</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> H001  F      <span style="text-decoration: underline;">2</span>022   173   583     39.7     -<span style="color: #BB0000;">119.</span>  30.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> H004  M      <span style="text-decoration: underline;">2</span>022   173   657     39.7     -<span style="color: #BB0000;">119.</span>  34.8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> H005  M      <span style="text-decoration: underline;">2</span>022   173   678     39.7     -<span style="color: #BB0000;">119.</span>  33.5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> H006  F      <span style="text-decoration: underline;">2</span>022   173   702     39.7     -<span style="color: #BB0000;">119.</span>  35.3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> H007  M      <span style="text-decoration: underline;">2</span>022   173   723     39.7     -<span style="color: #BB0000;">119.</span>  33.2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> H008  F      <span style="text-decoration: underline;">2</span>022   173   724     39.7     -<span style="color: #BB0000;">119.</span>  32.2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> H009  M      <span style="text-decoration: underline;">2</span>022   173   753     39.7     -<span style="color: #BB0000;">119.</span>  33.6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> H010  F      <span style="text-decoration: underline;">2</span>022   173   795     39.7     -<span style="color: #BB0000;">119.</span>  31.9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> H014  M      <span style="text-decoration: underline;">2</span>022   173   922     39.7     -<span style="color: #BB0000;">119.</span>  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> H015  M      <span style="text-decoration: underline;">2</span>022   173   941     39.7     -<span style="color: #BB0000;">119.</span>  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 160 more rows</span></span></span></code></pre>
<p>With this data our goal is to:</p>
<ol style="list-style-type: decimal">
<li><p>Quantify the distribution of temperatures experienced by these
lizards.</p></li>
<li><p>Assess how the relationship between their <code>tb</code> and the
temperatures they have available to gauge their ability to behaviorally
thermoregulate in this environment.</p></li>
</ol>
<p>To achieve these goals we can use the methodology developed in the
<code>throne</code> package which we detail below:</p>
</div>
<div class="section level2">
<h2 id="otm-deployement">OTM deployement<a class="anchor" aria-label="anchor" href="#otm-deployement"></a>
</h2>
<p>We deployed a total of 128 operative temperature models (OTMs)
randomly through the site that recorded <code>1</code> operative
temperature measurement per hour.</p>
<p><img src="case_study_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="flights">Flights<a class="anchor" aria-label="anchor" href="#flights"></a>
</h2>
<p>We flew 3 flights over an ~ 95000 <span class="math inline">\(m^2\)</span> area overlapping with the areas that
we surveyed as part of the lizard mark-recapture. Two flightswere
conducted on the same day (<code>08/04/2022</code>) at
<code>07:55</code> and <code>11:21</code> and a third flight was
conducted 2 days later at <code>16:05</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_flights_metadata</span></span></code></pre></div>
<pre><code><span><span class="co">##    flight_id     date time_start time_end</span></span>
<span><span class="co">## 1 c_flight_1 8/6/2022      16:05    16:28</span></span>
<span><span class="co">## 2 c_flight_2 8/4/2022      11:21    11:45</span></span>
<span><span class="co">## 3 c_flight_3 8/4/2022       7:55     8:19</span></span></code></pre>
<p><img src="images/c_study_area.png" width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="r-workflow">R workflow<a class="anchor" aria-label="anchor" href="#r-workflow"></a>
</h2>
<div class="section level3">
<h3 id="reading-and-processing-flights-data">Reading and processing flights data<a class="anchor" aria-label="anchor" href="#reading-and-processing-flights-data"></a>
</h3>
<p>Following the <code>R</code> workflow specified in the
<code>throne</code> package, the first step is to read and process the
flights data. An important part of this step is to specify the
<code>digits</code> argument which will set the spatial resolution of
each of the tiles in our final thermal landscape prediction. For this
example, we choose to set <code>digits = 5</code> as, at this latitude,
this will lead to a tile area of ~ 0.95 <span class="math inline">\(m^2\)</span>, which is representative of a micro
habitat a lizard might be experiencing. We read and process the flights
data using the <code>rnp_flights_data</code> function as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set files path</span></span>
<span><span class="va">flight_files_path</span> <span class="op">&lt;-</span> <span class="st">"x"</span> <span class="co"># This would be a folder within the user's computer, not specified here</span></span>
<span></span>
<span><span class="co"># read the metadata file </span></span>
<span><span class="va">c_flights_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"data/case_flight_data.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read and process flights data</span></span>
<span><span class="va">c_flights_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rnp_flights_data.html">rnp_flights_data</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">flight_files_path</span>, metadata <span class="op">=</span> <span class="va">c_flights_metadata</span>, digits <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p>The outcome will be a flights data <code>tibble</code> storing all of
surface temperature (<code>ir_temp</code>) measurements collected across
all flights:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_flights_data</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 304,368 × 7</span></span></span>
<span><span class="co">##    longitude latitude ir_temp  year   doy mod_start mod_end</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>     -<span style="color: #BB0000;">119.</span>     39.7    17.8  <span style="text-decoration: underline;">2</span>022   218       965     988</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>     -<span style="color: #BB0000;">119.</span>     39.7    18.2  <span style="text-decoration: underline;">2</span>022   218       965     988</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>     -<span style="color: #BB0000;">119.</span>     39.7    13.5  <span style="text-decoration: underline;">2</span>022   218       965     988</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>     -<span style="color: #BB0000;">119.</span>     39.7    26.8  <span style="text-decoration: underline;">2</span>022   218       965     988</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>     -<span style="color: #BB0000;">119.</span>     39.7    24.5  <span style="text-decoration: underline;">2</span>022   218       965     988</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>     -<span style="color: #BB0000;">119.</span>     39.7    18.0  <span style="text-decoration: underline;">2</span>022   218       965     988</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>     -<span style="color: #BB0000;">119.</span>     39.7    27.3  <span style="text-decoration: underline;">2</span>022   218       965     988</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>     -<span style="color: #BB0000;">119.</span>     39.7    27.2  <span style="text-decoration: underline;">2</span>022   218       965     988</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>     -<span style="color: #BB0000;">119.</span>     39.7    22.1  <span style="text-decoration: underline;">2</span>022   218       965     988</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>     -<span style="color: #BB0000;">119.</span>     39.7    22.7  <span style="text-decoration: underline;">2</span>022   218       965     988</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 304,358 more rows</span></span></span></code></pre>
<p>We can plot this data using <code>ggplot</code> tools to already get
a sense of the thermal characteristics of our site:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_flights_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, fill <span class="op">=</span> <span class="va">ir_temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"magma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">mod_start</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_files/figure-html/unnamed-chunk-9-1.png" width="960" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="reading-and-processing-otms-data">Reading and processing OTMs data<a class="anchor" aria-label="anchor" href="#reading-and-processing-otms-data"></a>
</h3>
<p>The next step would be to read and process the data collected via the
<strong>OTMs</strong>. We can do this by using the
<code>rnp_otms_data</code> function from the <code>throne</code>
package. Before we do that, we should check the structure of our raw OTM
<code>.csv</code> files. In this example they look like this:</p>
<pre><code><span><span class="co">##     raw_date_time temp otm</span></span>
<span><span class="co">## 1 6/13/2022 14:18 27.0 H22</span></span>
<span><span class="co">## 2 6/13/2022 15:18 18.0 H22</span></span>
<span><span class="co">## 3 6/13/2022 16:18 21.5 H22</span></span>
<span><span class="co">## 4 6/13/2022 17:18 16.0 H22</span></span>
<span><span class="co">## 5 6/13/2022 18:18 10.0 H22</span></span>
<span><span class="co">## 6 6/13/2022 19:18  8.0 H22</span></span></code></pre>
<p>By taking a look at this (and other files) we can tell that there is
no need to skip any rows when reading them as <code>.csv</code> which
means that we can set the <code>rows_skip</code> argument of
<code>rnp_otms_data</code> to <code>1</code>, such that it can start
reading from the first row. We can also see that the column
<code>raw_data_time</code> contains information on both the date and the
time of each measurement and thus, that we should set the
<code>date_col</code> argument to <code>1</code>. We could also specify
<code>time_col = 1</code>, but that’s not necessary as if no
<code>time_col</code> is specified, <code>rnp_flights_data</code> will
assume that <code>date_col = time_col</code>. Lastly, we can see from
this file that the operative temperature measurements are stored in the
third column and that, as a result, we should set the
<code>op_temp_col</code> argument to <code>2</code>. With this in mind,
we can read and process the OTM data as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># speficy the path to where the OTM .csv files are stored</span></span>
<span><span class="va">c_otms_path</span> <span class="op">&lt;-</span> <span class="st">"data/case_otm_data"</span></span>
<span></span>
<span><span class="co"># specify the OTM metadata file </span></span>
<span><span class="va">c_otms_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"data/case_otm_metadata.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read and process OTMs data</span></span>
<span><span class="va">c_otms_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rnp_otms_data.html">rnp_otms_data</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">c_otms_path</span>, metadata <span class="op">=</span> <span class="va">c_otms_metadata</span>, rows_skip <span class="op">=</span> <span class="fl">1</span>, date_col <span class="op">=</span> <span class="fl">1</span>, op_temp_col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>The outcome will be an otm data <code>tibble</code> containing all
the observations made by all OTMs:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">as_tibble</span><span class="op">(</span><span class="va">c_otms_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 262,016 × 7</span></span></span>
<span><span class="co">##    otm_id  year   doy   mod op_temp latitude longitude</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> H1      <span style="text-decoration: underline;">2</span>022   164   910    15       39.7     -<span style="color: #BB0000;">119.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> H1      <span style="text-decoration: underline;">2</span>022   164   970    17       39.7     -<span style="color: #BB0000;">119.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> H1      <span style="text-decoration: underline;">2</span>022   164  <span style="text-decoration: underline;">1</span>030    16       39.7     -<span style="color: #BB0000;">119.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> H1      <span style="text-decoration: underline;">2</span>022   164  <span style="text-decoration: underline;">1</span>090    15.5     39.7     -<span style="color: #BB0000;">119.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> H1      <span style="text-decoration: underline;">2</span>022   164  <span style="text-decoration: underline;">1</span>150    13       39.7     -<span style="color: #BB0000;">119.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> H1      <span style="text-decoration: underline;">2</span>022   164  <span style="text-decoration: underline;">1</span>210     9       39.7     -<span style="color: #BB0000;">119.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> H1      <span style="text-decoration: underline;">2</span>022   164  <span style="text-decoration: underline;">1</span>270     4       39.7     -<span style="color: #BB0000;">119.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> H1      <span style="text-decoration: underline;">2</span>022   164  <span style="text-decoration: underline;">1</span>330     2.5     39.7     -<span style="color: #BB0000;">119.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> H1      <span style="text-decoration: underline;">2</span>022   164  <span style="text-decoration: underline;">1</span>390     2       39.7     -<span style="color: #BB0000;">119.</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> H1      <span style="text-decoration: underline;">2</span>022   165    10     1       39.7     -<span style="color: #BB0000;">119.</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 262,006 more rows</span></span></span></code></pre>
<p>As seen below, not all OTMs fell within the area we covered in our
flights. This is because here we are only presenting a subset of all
flights collected and lizard observations. Nonetheless, the fact that
only the thermal dynamics of a given OTM (not its position) is the only
characteristic we use to predict thermal landscapes, we can use OTMs
that fell outside of our area of interest as long as they were recording
at the same time the flights took place:</p>
<p><img src="case_study_files/figure-html/unnamed-chunk-13-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="building-otm-spline-models">Building OTM spline models<a class="anchor" aria-label="anchor" href="#building-otm-spline-models"></a>
</h3>
<p>Having read the OTMs data, the next step is to define <strong>cubic
splines models</strong> to describe the thermal dynamics of each OTM on
each <code>doy</code> during its deployment. To do this, we can use the
<code>gen_otm_splines</code> function of the <code>throne</code>
package. For this step, a crucial user input is the <code>knot_p</code>
parameter which will determine the “wiggliness” of the spline model. <a href="https://ggcostoya.github.io/throne/articles/rnp_otms_data_gen_otm_splines.html#choosing-the-appropriate-knot_p-value-">Choosing
th appropriate <code>knot_p</code> value</a> is dependent on the
recording frequency at which we set our OTMs and the thermal properties
of the organism of interest itself. Based on the thermal properties of
our organism of interest (<em>Sceloporus occidentalis</em>), we would
ideally a spline model with 1 knot for every 15 minutes but our OTMs
recorded at afrequency of 1 observation / hour. At this frequency, we
want to preserve as much information on the thermal fluctuations of the
OTM as possible which is why setting <code>knot_p = 1</code> works fine.
To obtain the spline models, we can simply run:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_otms_splines</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_otm_splines.html">gen_otm_splines</a></span><span class="op">(</span>otm_data <span class="op">=</span> <span class="va">c_otms_data</span>, knot_p <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Which returns a nested <code>tibble</code> with all
<code>otm_id</code> &amp; <code>doy</code> specific models (in the
column <code>spline</code>):</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_otms_splines</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 11,008 × 6</span></span></span>
<span><span class="co">##    otm_id  year   doy latitude longitude spline    </span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> H1      <span style="text-decoration: underline;">2</span>022   164     39.7     -<span style="color: #BB0000;">119.</span> <span style="color: #949494;">&lt;smth.spl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> H1      <span style="text-decoration: underline;">2</span>022   165     39.7     -<span style="color: #BB0000;">119.</span> <span style="color: #949494;">&lt;smth.spl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> H1      <span style="text-decoration: underline;">2</span>022   166     39.7     -<span style="color: #BB0000;">119.</span> <span style="color: #949494;">&lt;smth.spl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> H1      <span style="text-decoration: underline;">2</span>022   167     39.7     -<span style="color: #BB0000;">119.</span> <span style="color: #949494;">&lt;smth.spl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> H1      <span style="text-decoration: underline;">2</span>022   168     39.7     -<span style="color: #BB0000;">119.</span> <span style="color: #949494;">&lt;smth.spl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> H1      <span style="text-decoration: underline;">2</span>022   169     39.7     -<span style="color: #BB0000;">119.</span> <span style="color: #949494;">&lt;smth.spl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> H1      <span style="text-decoration: underline;">2</span>022   170     39.7     -<span style="color: #BB0000;">119.</span> <span style="color: #949494;">&lt;smth.spl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> H1      <span style="text-decoration: underline;">2</span>022   171     39.7     -<span style="color: #BB0000;">119.</span> <span style="color: #949494;">&lt;smth.spl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> H1      <span style="text-decoration: underline;">2</span>022   172     39.7     -<span style="color: #BB0000;">119.</span> <span style="color: #949494;">&lt;smth.spl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> H1      <span style="text-decoration: underline;">2</span>022   173     39.7     -<span style="color: #BB0000;">119.</span> <span style="color: #949494;">&lt;smth.spl&gt;</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 10,998 more rows</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="correcting-flights-data">Correcting flights data<a class="anchor" aria-label="anchor" href="#correcting-flights-data"></a>
</h3>
<p>Due to [the inherent differences in the physical properties of the
surface temperature measurements from an IR camera and the operative
temperature measurements from an OTM] (<a href="https://ggcostoya.github.io/throne/articles/correcting_flight_data.html#overview" class="uri">https://ggcostoya.github.io/throne/articles/correcting_flight_data.html#overview</a>),
the next step in the <code>throne</code> package workflow is to correct
the data obtained via flights using OTM flights data. To achieve this,
we will use the <code>correct_flighs_data</code> function as
follows:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>c_flights_data_corr <span class="ot">&lt;-</span> <span class="fu">correct_flights_data</span>(flights<span class="sc">-</span><span class="at">data =</span> c_flights_data, <span class="at">otm_splines =</span> c_otms_splines)</span></code></pre></div>
<p>We can visualize below the effects of the correction process
(<code>Post-correction</code>) with respect to the data from the
original flights (<code>Pre-correction</code>).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pre_corr</span> <span class="op">&lt;-</span> <span class="va">c_flights_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, fill <span class="op">=</span> <span class="va">ir_temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"magma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">mod_start</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Pre-correction"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">post_corr</span> <span class="op">&lt;-</span> <span class="va">c_flights_data_corr</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span>, fill <span class="op">=</span> <span class="va">op_temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"magma"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">mod_start</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Post-correction"</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="fu">grid.arrange</span><span class="op">(</span><span class="va">pre_corr</span>, <span class="va">post_corr</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_files/figure-html/unnamed-chunk-17-1.png" width="960" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="matching-tiles-to-otm-dynamics">Matching tiles to OTM dynamics<a class="anchor" aria-label="anchor" href="#matching-tiles-to-otm-dynamics"></a>
</h3>
<p>The last step before being able to predict thermal landscapes is to
match the thermal dynamics of each of the tiles within our corrected
flights data to the dynamics of a given OTM. To achieve this, we can use
the <code>match_data</code> function from the <code>throne</code>
package. To use this function, two user-specific inputs are needed:
<code>coverage_per</code> and <code>error_max</code>. The first one
determines the degree of coverage across multiple flights that a tile
needs to have in order to be considered in the matching process. As seen
below, our flights had a particularly good overlap:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_flights_data_corr</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">latitude</span>, <span class="va">longitude</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>coverage_per <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_raster</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">coverage_per</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">guide_colorbar</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Coverage (%)"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="case_study_files/figure-html/unnamed-chunk-18-1.png" width="576" style="display: block; margin: auto;"></p>
<p>In our case, we can set <code>coverage_per = 1</code> to ensure that
only areas covered across all flights are considered although, for a
greater number of flights we would recommend setting
<code>coverage_per = 0.9</code>. The second input
(<code>error_max</code>) determines the maximum average absolute error
between a tile and OTM dynamics that should be specified as a threshold
for the matching. If the average absolute difference between a tile’s
thermal dynamics and the OTM that best describes it is &gt;
<code>error_max</code>, that tile is not matched to any OTM and thus
should not be considered. In this case, we will follow our own
specifications and set <code>error_max = 5</code>. Now, we can run the
<code>match_data</code> function as follows:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_matches</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/match_data.html">match_data</a></span><span class="op">(</span>flights_data <span class="op">=</span> <span class="va">c_flights_data_corr</span>, otm_splines <span class="op">=</span> <span class="va">c_otms_splines</span>, coverage_per <span class="op">=</span> <span class="fl">1</span>, error_max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p>The result will be a matches <code>tibble</code> with the OTM that
best describes the dynamics of each tile in the site. In the figure
below, each tile is colored according to the <code>otm_id</code> that
best represents it’s thermal dynamics.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">c_matches</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 98,363 × 4</span></span></span>
<span><span class="co">##    latitude longitude otm_id  error</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>     39.7     -<span style="color: #BB0000;">119.</span> <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>     39.7     -<span style="color: #BB0000;">119.</span> H121    0.842</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>     39.7     -<span style="color: #BB0000;">119.</span> H6      2.17 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>     39.7     -<span style="color: #BB0000;">119.</span> H16     3.06 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>     39.7     -<span style="color: #BB0000;">119.</span> H4      1.39 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>     39.7     -<span style="color: #BB0000;">119.</span> H56     2.44 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>     39.7     -<span style="color: #BB0000;">119.</span> H78     2.15 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>     39.7     -<span style="color: #BB0000;">119.</span> H132    2.89 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>     39.7     -<span style="color: #BB0000;">119.</span> H36     1.86 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>     39.7     -<span style="color: #BB0000;">119.</span> H6      1.32 </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 98,353 more rows</span></span></span></code></pre>
<p><img src="case_study_files/figure-html/unnamed-chunk-21-1.png" width="432" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="predicting-thermal-landscapes">Predicting thermal landscapes<a class="anchor" aria-label="anchor" href="#predicting-thermal-landscapes"></a>
</h2>
<p><img src="images/case_dynamic_thermal_landscape.gif" width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="effectiveness-of-thermoregulatory-behavior-">Effectiveness of thermoregulatory behavior.<a class="anchor" aria-label="anchor" href="#effectiveness-of-thermoregulatory-behavior-"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
